<!doctype html>
<html lang="mn">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>IAT Words ‚Äî 9 Parts</title>
<style>
  body { font-family:"Times New Roman",serif; background:#f7fbfd; margin:0; }
  .frame { border:6px solid #bfe3f1; background:#fff; padding:24px 30px; width:900px; max-width:94vw; margin:36px auto; }
  .top { display:grid; grid-template-columns:1fr auto 1fr; }
  .hint { font-size:13px; color:#333; text-align:center; }
  .left,.right { font-size:32px; font-weight:700; color:#2f9b30; margin-top:6px; }
  .left { text-align:left } .right { text-align:right }
  .part { text-align:center; margin:18px 0; font-weight:700; }
  .instructions { font-size:16px; line-height:1.55; color:#111; }
  .instructions .category{ color:#2f9b30; font-weight:700 }
  .instructions .redx{ color:#c62828; font-weight:800 }
  .start { text-align:center; margin-top:22px; font-size:18px; font-weight:700 }
  .btn{ display:inline-block; padding:10px 16px; border:1px solid #b3b3b3; border-radius:4px; background:#f6f6f6; cursor:pointer; font-weight:700 }
  .btn:active{ transform:translateY(1px) }
  .hidden { display:none }
  .stimulus { text-align:center; font-size:46px; font-weight:700; margin:56px 0 12px }
  .bigx{ color:#c62828; font-weight:800; font-size:42px; text-align:center; margin-top:6px; }
  .form-row{ display:grid; grid-template-columns:180px 1fr; align-items:center; gap:10px; margin:10px 0; }
  label{ font-weight:700 }
  input, select{ font-family:inherit; font-size:16px; padding:8px 10px; border:1px solid #b3b3b3; border-radius:4px }
  .note{ font-size:14px; color:#444 }
  .err{ color:#c62828; font-size:14px; margin-top:8px }

  /* Mobile buttons for E/I */
  .mobile-buttons { display: none; justify-content: center; gap: 20px; margin: 30px 0; }
  .mobile-btn { padding: 15px 30px; font-size: 20px; font-weight: 700; border: 2px solid #2f9b30; border-radius: 8px; background: #f0f9f0; cursor: pointer; min-width: 100px; text-align: center; }
  .mobile-btn:active { background: #d0f0d0; transform: translateY(2px); }
  .mobile-btn-e { border-color: #2f5b9b; background: #f0f0f9; }
  .mobile-btn-i { border-color: #9b2f5b; background: #f9f0f3; }

  /* Survey Styles */
  .survey-title { font-size: 20px; font-weight: 700; text-align: center; margin-bottom: 16px; color: #2f9b30; }
  .survey-intro { font-size: 14px; line-height: 1.5; color: #444; margin-bottom: 20px; text-align: center; padding: 0 10px; }
  .survey-nav { text-align: center; margin-top: 24px; }
  .survey-question { margin: 16px 0; padding: 16px; border: 1px solid #e0e0e0; border-radius: 8px; background: #f9f9f9; }
  .survey-question-text { font-weight: 600; margin-bottom: 12px; font-size: 15px; }
  .survey-options { display: flex; flex-direction: column; gap: 10px; }
  .survey-option { display: flex; align-items: center; gap: 10px; padding: 8px; border-radius: 4px; cursor: pointer; }
  .survey-option:hover { background: #e8f4fd; }
  .survey-option input { margin: 0; }
  .survey-option label { font-weight: normal; cursor: pointer; margin: 0; }

  /* Completion UI */
  .results-box { border:6px solid #bfe3f1; background:#fff; padding:20px 24px; width:900px; max-width:94vw; margin:24px auto; }
  .results-title { font-size:18px; font-weight:700; margin-bottom:8px; }
  .results-role { margin:8px 0; padding:10px; border-radius:8px; background:#f3f7fb; }
  .results-actions { margin-top:14px; display:flex; gap:10px; flex-wrap:wrap; }
  .btn-primary { background:#2b6df6; color:#fff; border-color:#2b6df6; }
  .btn-success { background:#2fb56e; color:#fff; border-color:#2fb56e; }
  .btn-warning { background:#f0ad4e; color:#fff; border-color:#f0ad4e; }
  .small-note { margin-top:10px; color:#6b7280; font-size:13px; }
  pre.results-preview { white-space:pre-wrap; background:#0b1220; color:#eaf0ff; padding:10px; border-radius:6px; margin-top:12px; overflow:auto; max-height:240px; }

  /* Mobile responsiveness */
  @media (max-width: 768px) {
    .frame { padding: 16px 20px; margin: 20px auto; }
    .mobile-buttons { display: flex; }
    .stimulus { font-size: 36px; margin: 30px 0 12px; }
    .left, .right { font-size: 24px; }
    .form-row { grid-template-columns: 1fr; gap: 5px; }
  }
</style>
</head>
<body>

<!-- ===== 1) SETUP ===== -->
<div class="frame" id="setup">
  <div class="part">–û—Ä–æ–ª—Ü–æ–≥—á–∏–π–Ω –º—ç–¥—ç—ç–ª—ç–ª</div>
  <div class="form-row">
    <label for="pid">ID / –ù—ç—Ä<span style="color:#c62828">*</span></label>
    <input id="pid" placeholder="–ñ–∏—à—ç—ç: B.Batbayar" />
  </div>
  <div class="form-row">
    <label for="age">–ù–∞—Å<span style="color:#c62828">*</span></label>
    <input id="age" type="number" min="5" max="120" placeholder="–ñ–∏—à—ç—ç: 23" />
  </div>
  <div class="form-row">
    <label for="gender">–•“Ø–π—Å</label>
    <select id="gender">
      <option value="">–°–æ–Ω–≥–æ—Ö</option>
      <option value="male">–≠—Ä</option>
      <option value="female">–≠–º</option>
      <option value="other">–ë—É—Å–∞–¥</option>
    </select>
  </div>
  <div class="note">Enter –¥–∞—Ä–∂ —ç—Å–≤—ç–ª –¥–æ–æ—Ä—Ö —Ç–æ–≤—á–∏–π–≥ –¥–∞—Ä–∂ “Ø—Ä–≥—ç–ª–∂–ª“Ø“Ø–ª–Ω—ç.</div>
  <div style="text-align:center; margin-top:14px">
    <button class="btn" type="button" onclick="window.goIntro()">–ó–∞–∞–≤–∞—Ä—Ç —à–∏–ª–∂–∏—Ö</button>
  </div>
  <div class="err hidden" id="setupErr"></div>
</div>

<!-- ===== 2) INSTRUCTIONS ===== -->
<div class="frame hidden" id="intro">
  <div class="top">
    <div class="hint">Press "E" for</div><div></div><div class="hint">Press "I" for</div>
    <div class="left" id="leftCategory">–ë–∏</div><div></div><div class="right" id="rightCategory">–¢—ç–¥</div>
  </div>
  <div class="part" id="introPartLabel">Part 1 of 9</div>
  <div class="instructions" id="instructionsText">
    <p>–ó“Ø“Ø–Ω –≥–∞—Ä—ã–Ω –¥—É–Ω–¥ —ç—Å–≤—ç–ª –¥–æ–ª–æ–æ–≤–æ—Ä —Ö—É—Ä—É—É–≥ –∫–æ–º–ø—å—é—Ç–µ—Ä–∏–π–Ω –≥–∞—Ä–Ω—ã E —Ç–æ–≤—á–ª—É—É—Ä, –±–∞—Ä—É—É–Ω –≥–∞—Ä—ã–Ω –¥—É–Ω–¥ —ç—Å–≤—ç–ª –¥–æ–ª–æ–æ–≤–æ—Ä —Ö—É—Ä—É—É–≥ –∫–æ–º–ø—å—é—Ç–µ—Ä–∏–π–Ω –≥–∞—Ä–Ω—ã I —Ç–æ–≤—á–ª—É—É—Ä –¥—ç—ç—Ä —Ç—É—Å —Ç—É—Å –±–∞–π—Ä–ª—É—É–ª. ... –¢–∞ –∑–∞–∞–≤—Ä—ã–≥ –æ–π–ª–≥–æ—Å–æ–Ω –±–æ–ª "–ó–ê–ô –ê–í–ê–• –¢–û–í–ß–õ–£–£–†" –¥–∞—Ä–∂ —Ç—É—Ä—à–∏–ª—Ç—ã–≥ —ç—Ö—ç–ª–Ω—ç.</p>
  </div>
  <div class="start">Press the <b>space bar</b> when you are ready to start.</div>
  <div style="text-align:center; margin-top:12px">
    <button class="btn" id="btnStart">–≠—Ö–ª—ç—Ö</button>
  </div>
</div>

<!-- ===== 3) STAGE ===== -->
<div class="frame hidden" id="stage">
  <div class="top">
    <div class="hint">Press "E" for</div><div></div><div class="hint">Press "I" for</div>
    <div class="left" id="stageLeftCategory">–ë–∏</div><div></div><div class="right" id="stageRightCategory">–¢—ç–¥</div>
  </div>
  <div class="part" id="partLabel">Part 1 of 9</div>
  <div class="stimulus" id="stimulusWord">Smile</div>
  
  <!-- Mobile buttons for E/I -->
  <div class="mobile-buttons" id="mobileButtons">
    <button class="mobile-btn mobile-btn-e" id="btnMobileE">E</button>
    <button class="mobile-btn mobile-btn-i" id="btnMobileI">I</button>
  </div>
  
  <div id="errorX" class="bigx hidden">X</div>
</div>

<!-- ===== 4) SURVEY 1: Self-Esteem ===== -->
<div class="frame hidden" id="survey1">
  <div class="survey-title">”®”©—Ä–∏–π–Ω “Æ–Ω—ç–ª—ç–º–∂–∏–π–Ω –ê—Å—É—É–ª–≥–∞</div>
  <div class="survey-intro">
    –≠–Ω—ç –∞—Å—É—É–ª–≥–∞ –Ω—å —Ç–∞–Ω—ã ”©”©—Ä–∏–π–≥”©”© “Ø–Ω—ç–ª—ç—Ö —Ç“Ø–≤—à–∏–Ω–≥ —Ç–æ–¥–æ—Ä—Ö–æ–π–ª–æ—Ö –∑–æ—Ä–∏–ª–≥–æ—Ç–æ–π. –¢–∞ ”©–≥“Ø“Ø–ª–±—ç—Ä –±“Ø—Ä–∏–π–≥ —É–Ω—à–∞–∞–¥ ”©”©—Ä—Ç —Ö–∞–º–≥–∏–π–Ω –æ–π—Ä —Å–∞–Ω–∞–≥–¥—Å–∞–Ω —Ö–∞—Ä–∏—É–ª—Ç—ã–≥ —Å–æ–Ω–≥–æ–Ω–æ —É—É. –ó”©–≤ –±—É—Ä—É—É –≥—ç—Å—ç–Ω —Ö–∞—Ä–∏—É–ª—Ç –±–∞–π—Ö–≥“Ø–π —É—á–∏—Ä —Ç–∞–Ω—ã –º—ç–¥—Ä—ç–º–∂, –±–æ–¥–æ–ª —Ö–∞–º–≥–∏–π–Ω –∑”©–≤ —Ö–∞—Ä–∏—É–ª—Ç –±–æ–ª–Ω–æ. –•–∞—Ä–∏—É–ª–∞—Ö–¥–∞–∞ –¥–æ–æ—Ä—Ö –¥”©—Ä–≤”©–Ω —Å–æ–Ω–≥–æ–ª—Ç–æ–æ—Å –∞–ª—å –Ω—ç–≥–∏–π–≥ —Ç—ç–º–¥—ç–≥–ª—ç–Ω—ç “Ø“Ø.
  </div>
  <div id="survey1Questions"></div>
  <div class="survey-nav">
    <button class="btn btn-success" id="btnSurvey1Next">–î–∞—Ä–∞–∞—á–∏–π–Ω –∞—Å—É—É–ª–≥–∞ —Ä—É—É —à–∏–ª–∂–∏—Ö</button>
  </div>
  <div class="err hidden" id="survey1Err"></div>
</div>

<!-- ===== 5) SURVEY 2: Emotions ===== -->
<div class="frame hidden" id="survey2">
  <div class="survey-title">–°—ç—Ç–≥—ç–ª –•”©–¥–ª”©–ª, –ú—ç–¥—Ä—ç–º–∂–∏–π–Ω –ê—Å—É—É–ª–≥–∞</div>
  <div class="survey-intro">
    –≠–Ω—ç—Ö“Ø“Ø –∞—Å—É—É–ª–≥–∞ –Ω—å —Ç–æ–¥–æ—Ä—Ö–æ–π –∞–≥—à–∏–Ω–¥ —Ç”©—Ä–∂ –±—É–π —Å—ç—Ç–≥—ç–ª —Ö”©–¥–ª”©–ª, –º—ç–¥—Ä—ç–º–∂–∏–π–≥ —Ç—ç–º–¥—ç–≥–ª—ç—Ö –∑–æ—Ä–∏–ª–≥–æ—Ç–æ–π “Ø–≥—Å–∏–π–Ω –∂–∞–≥—Å–∞–∞–ª—Ç–∞–∞—Å –±“Ø—Ä–¥—Å—ç–Ω –±–æ–ª–Ω–æ. –≠–¥–≥—ç—ç—Ä—ç—ç—Å —Ç–∞–Ω–¥ “Ø“Ø—Å—á –±—É–π —Å—ç—Ç–≥—ç–ª –º—ç–¥—Ä—ç–º–∂–∏–¥ —Ç–æ—Ö–∏—Ä—Å–æ–Ω “Ø–∑“Ø“Ø–ª—ç–ª—Ç–∏–π–≥ —Å–æ–Ω–≥–æ–Ω–æ —É—É.
  </div>
  <div id="survey2Questions"></div>
  <div class="survey-nav">
    <button class="btn btn-success" id="btnSurvey2Submit">–î—É—É—Å–≥–∞—Ö</button>
  </div>
  <div class="err hidden" id="survey2Err"></div>
</div>

<!-- ===== 6) COMPLETION (mount) ===== -->
<div id="completionMount"></div>

<script>
/* ========== Constants & Data ========== */
const TOTAL_PARTS = 9;

const SELF_WORDS = ["–ë–∏", "–Ω–∞–¥–∞–¥", "–º–∏–Ω–∏–π", "–º–∏–Ω–∏–π—Ö", "”©”©—Ä”©”©"];
const OTHER_WORDS = ["—Ç—ç–¥–Ω–∏–π–≥", "—Ç—ç–¥–Ω–∏–π", "—Ç—ç–¥–Ω–∏–π—Ö", "—Ç—ç–¥—ç–Ω–¥", "—Ç—ç–¥"];
const POS_WORDS = ["–≥–∞–π—Ö–∞–º—à–∏–≥—Ç–∞–π", "“Ø–∑—ç—Å–≥—ç–ª—ç–Ω—Ç—ç–π", "—Å–∞–π—Ö–∞–Ω", "—Å–∞–π–Ω", "–∂–∞—Ä–≥–∞–ª—Ç–∞–π"];
const NEG_WORDS = ["–®–æ–æ–≤–¥–æ—Ä", "–∑–æ–≤–ª–æ–Ω—Ç–æ–π", "—Ö–∞—Ä–≥–∏—Å", "–∞–π–º–∞–∞—Ä", "—è–¥–∞—Ä–≥–∞–∞—Ç–∞–π"];

// Instructions for each part
const PART_INSTRUCTIONS = [
  // Part 1: Self vs Others
  "–ó“Ø“Ø–Ω –≥–∞—Ä—ã–Ω –¥—É–Ω–¥ —ç—Å–≤—ç–ª –¥–æ–ª–æ–æ–≤–æ—Ä —Ö—É—Ä—É—É–≥ –∫–æ–º–ø—å—é—Ç–µ—Ä–∏–π–Ω –≥–∞—Ä–Ω—ã E —Ç–æ–≤—á–ª—É—É—Ä, –±–∞—Ä—É—É–Ω –≥–∞—Ä—ã–Ω –¥—É–Ω–¥ —ç—Å–≤—ç–ª –¥–æ–ª–æ–æ–≤–æ—Ä —Ö—É—Ä—É—É–≥ –∫–æ–º–ø—å—é—Ç–µ—Ä–∏–π–Ω –≥–∞—Ä–Ω—ã I —Ç–æ–≤—á–ª—É—É—Ä –¥—ç—ç—Ä —Ç—É—Å —Ç—É—Å –±–∞–π—Ä–ª—É—É–ª. –î—ç–ª–≥—ç—Ü–∏–π–Ω –∑“Ø“Ø–Ω –¥—ç—ç–¥ —Ç–∞–ª–¥ \"–ë–∏\", –±–∞—Ä—É—É–Ω –¥—ç—ç–¥ —Ç–∞–ª–¥ \"–¢—ç–¥\" –≥—ç—Å—ç–Ω 2 –∞–Ω–≥–∏–ª–∞–ª ”©–≥”©–≥–¥”©–Ω”©. –î—ç–ª–≥—ç—Ü–∏–π–Ω –¥—ç—ç–¥ —Ç–∞–ª–¥ ”©–≥”©–≥–¥—Å”©–Ω —Ö–æ—ë—Ä –∞–Ω–≥–∏–ª–∞–ª–¥ —Ö–∞–º–∞–∞—Ä–∞—Ö “Ø–≥–Ω“Ø“Ø–¥ –¥—ç–ª–≥—ç—Ü–∏–π–Ω –≥–æ–ª–¥ –Ω—ç–≥ –Ω—ç–≥—ç—ç—Ä—ç—ç –≥–∞—Ä—á –∏—Ä–Ω—ç. –ó“Ø“Ø–Ω —Ç–∞–ª—ã–Ω \"–ë–∏\" –∞–Ω–≥–∏–ª–∞–ª–¥ —Ö–∞–º–∞–∞—Ä–∞—Ö “Ø–≥ –≥–∞—Ä—á –∏—Ä–≤—ç–ª E —Ç–æ–≤—á–ª—É—É—Ä—ã–≥; —Ö–∞—Ä–∏–Ω –±–∞—Ä—É—É–Ω —Ç–∞–ª—ã–Ω \"–¢—ç–¥\" –∞–Ω–≥–∏–ª–∞–ª–¥ —Ö–∞–º–∞–∞—Ä–∞—Ö “Ø–≥ –≥–∞—Ä—á –∏—Ä–≤—ç–ª I —Ç–æ–≤—á–ª—É—É—Ä—ã–≥ –¥–∞—Ä. “Æ–≥ –±“Ø—Ä –∑”©–≤—Ö”©–Ω —ç–¥–≥—ç—ç—Ä–∏–π–Ω –∞–ª—å –Ω—ç–≥ –∞–Ω–≥–∏–ª–∞–ª–¥ —Ö–∞–º–∞–∞—Ä–Ω–∞. –•—ç—Ä—ç–≤ –¢–∞ –∞–ª–¥–∞–∞ –≥–∞—Ä–≥–∞–≤–∞–ª –¥—ç–ª–≥—ç—Ü–∏–π–Ω –≥–æ–ª–¥ \"–•\" –≥–∞—Ä—á –∏—Ä–Ω—ç. –•—ç—Ä—ç–≤ –¢–∞ –∞–ª–¥–∞–∞ –≥–∞—Ä–≥–∞–≤–∞–ª –∑”©–≤ —Ç–æ–≤—á–ª—É—É—Ä—ã–≥ –¥–∞—Ä. –≠–Ω—ç—Ö“Ø“Ø –¥–∞–∞–ª–≥–∞–≤–∞—Ä –Ω—å –≥“Ø–π—Ü—ç—Ç–≥—ç—Å—ç–Ω —Ö—É–≥–∞—Ü–∞–∞–≥–∞–∞—Ä —Ö—ç–º–∂–∏–≥–¥–¥—ç–≥ —Ç—É–ª \"–ß–ê–î–ê–• –ß–ò–ù–≠–≠–ì–≠–≠–†–≠–≠ –•–£–†–î–ê–ù\" –º”©–Ω –∞–ª—å –±–æ–ª–æ—Ö \"–ê–õ–î–ê–ê–ì“Æ–ô –ì“Æ–ô–¶–≠–¢–ì–≠\". –•—ç—Ä—ç–≤ –¢–∞ —Ö—ç—Ç—ç—Ä—Ö–∏–π —É–¥–∞–∞–Ω –∞–∂–∏–ª–ª–∞–∂, –æ–ª–æ–Ω –∞–ª–¥–∞–∞ –≥–∞—Ä–≥–∞–≤–∞–ª “Ø—Ä –¥“Ø–Ω–≥ —Ç–æ–æ—Ü–æ—Ö –±–æ–ª–æ–º–∂–≥“Ø–π –±–æ–ª–Ω–æ. –î–∞–∞–ª–≥–∞–≤—Ä—ã–≥ —Ö–∏–π–∂ –≥“Ø–π—Ü—ç—Ç–≥—ç—Ö—ç–¥ –æ–π—Ä–æ–ª—Ü–æ–æ–≥–æ–æ—Ä 5 –º–∏–Ω—É—Ç —à–∞–∞—Ä–¥–∞–≥–¥–∞–Ω–∞. –¢–∞–Ω–¥ –∞–º–∂–∏–ª—Ç —Ö“Ø—Å—å–µ. –¢–∞ –∑–∞–∞–≤—Ä—ã–≥ –æ–π–ª–≥–æ—Å–æ–Ω –±–æ–ª \"–ó–ê–ô –ê–í–ê–• –¢–û–í–ß–õ–£–£–†\" –¥–∞—Ä–∂ —Ç—É—Ä—à–∏–ª—Ç—ã–≥ —ç—Ö—ç–ª–Ω—ç.",

  // Part 2: Positive vs Negative
  "–î—ç–ª–≥—ç—Ü–∏–π–Ω –¥—ç—ç–¥ —Ç–∞–ª—ã–Ω ”©–º–Ω”©—Ö –∞–Ω–≥–∏–ª–∞–ª—É—É–¥ ”©”©—Ä—á–ª”©–≥–¥”©–∂ –¥—ç–ª–≥—ç—Ü–∏–π–Ω –∑“Ø“Ø–Ω –¥—ç—ç–¥ —Ç–∞–ª–¥ \"–°–∞–π–Ω\", –±–∞—Ä—É—É–Ω –¥—ç—ç–¥ —Ç–∞–ª–¥ \"–ú—É—É\" –≥—ç—Å—ç–Ω 2 –∞–Ω–≥–∏–ª–∞–ª ”©–≥”©–≥–¥—Å”©–Ω –±–∞–π–Ω–∞. –ú”©–Ω 2 –∞–Ω–≥–∏–ª–∞–ª–¥ —Ö–∞–º–∞–∞—Ä–∞—Ö “Ø–≥—Å —á ”©”©—Ä—á–ª”©–≥–¥—Å”©–Ω. –ì—ç—Ö–¥—ç—ç –¥–∞–∞–ª–≥–∞–≤—Ä—ã–Ω –¥“Ø—Ä—ç–º —Ö—ç–≤—ç—ç—Ä—ç—ç. –ó“Ø“Ø–Ω —Ç–∞–ª—ã–Ω \"–°–∞–π–Ω\" –∞–Ω–≥–∏–ª–∞–ª–¥ —Ö–∞–º–∞–∞—Ä–∞—Ö “Ø–≥ –≥–∞—Ä—á –∏—Ä–≤—ç–ª E —Ç–æ–≤—á–ª—É—É—Ä—ã–≥; —Ö–∞—Ä–∏–Ω –±–∞—Ä—É—É–Ω —Ç–∞–ª—ã–Ω \"–ú—É—É\" –∞–Ω–≥–∏–ª–∞–ª–¥ —Ö–∞–º–∞–∞—Ä–∞—Ö “Ø–≥ –≥–∞—Ä—á –∏—Ä–≤—ç–ª I —Ç–æ–≤—á–ª—É—É—Ä—ã–≥ –¥–∞—Ä. “Æ–≥ –±“Ø—Ä –∑”©–≤—Ö”©–Ω —ç–¥–≥—ç—ç—Ä–∏–π–Ω –∞–ª—å –Ω—ç–≥ –∞–Ω–≥–∏–ª–∞–ª–¥ —Ö–∞–º–∞–∞—Ä–Ω–∞. –•—ç—Ä—ç–≤ –¢–∞ –∞–ª–¥–∞–∞ –≥–∞—Ä–≥–∞–≤–∞–ª –¥—ç–ª–≥—ç—Ü–∏–π–Ω –≥–æ–ª–¥ \"–•\" –≥–∞—Ä—á –∏—Ä–Ω—ç. –•—ç—Ä—ç–≤ –¢–∞ –∞–ª–¥–∞–∞ –≥–∞—Ä–≥–∞–≤–∞–ª –∑”©–≤ —Ç–æ–≤—á–ª—É—É—Ä—ã–≥ –¥–∞—Ä. –î–∞–∞–ª–≥–∞–≤—Ä—ã–≥ \"–ß–ê–î–ê–• –ß–ò–ù–≠–≠–ì–≠–≠–†–≠–≠ –•–£–†–î–ê–ù –ì“Æ–ô–¶–≠–¢–ì–≠\". –¢–∞ –∑–∞–∞–≤—Ä—ã–≥ –æ–π–ª–≥–æ—Å–æ–Ω –±–æ–ª \"–ó–ê–ô –ê–í–ê–• –¢–û–í–ß–õ–£–£–†\" –¥–∞—Ä–∂ —Ç—É—Ä—à–∏–ª—Ç—ã–≥ —ç—Ö—ç–ª–Ω—ç.",

  // Part 3: Self+Positive vs Others+Negative
  "–î—ç–ª–≥—ç—Ü–∏–π–Ω –¥—ç—ç–¥ —Ç–∞–ª–¥ ”©–º–Ω”© –Ω—å —Ç—É—Å —Ç—É—Å–¥–∞–∞ –±–∞–π—Å–∞–Ω –¥”©—Ä–≤”©–Ω –∞–Ω–≥–∏–ª–∞–ª –æ–¥–æ–æ –Ω–∏–π–ª–∂, –¥—ç–ª–≥—ç—Ü–∏–π–Ω –∑“Ø“Ø–Ω –¥—ç—ç–¥ —Ç–∞–ª–¥ \"–ë–∏ —ç—Å–≤—ç–ª –°–∞–π–Ω\", \"–ë—É—Å–∞–¥ —ç—Å–≤—ç–ª –ú—É—É\" –≥—ç—Å—ç–Ω –±“Ø–ª—ç–≥ –±–æ–ª–æ–Ω —Ö–∞—Ä–∞–≥–¥–∞–∂ –±–∞–π–Ω–∞. –î—ç–ª–≥—ç—Ü–∏–π–Ω –≥–æ–ª–¥ –≥–∞—Ä–∞—Ö “Ø–≥ –±“Ø—Ä –∑”©–≤—Ö”©–Ω –Ω—ç–≥ –ª –±“Ø–ª—ç–≥—Ç —Ö–∞–º–∞–∞—Ä–Ω–∞ –≥—ç–¥–≥–∏–π–≥ —Å–∞–Ω–∞. –¢—É—Ö–∞–π–ª–±–∞–ª, —Ö—ç—Ä—ç–≤ –ë–∏ –±–∞ –°–∞–π–Ω –∞–Ω–≥–∏–ª–ª—É—É–¥ —Ç—É—Å —Ç—É—Å–¥–∞–∞ –±–∞–π—Å–∞–Ω –±–æ–ª \"–ë–∏\"-–¥ —Ö–∞–º–∞–∞—Ä–∞—Ö —É—Ç–≥–∞—Ç–∞–π “Ø–≥—Å \"–°–∞–π–Ω\" –∞–Ω–≥–∏–ª–∞–ª–¥ —Ö–∞–º–∞–∞—Ä–∞—Ö–≥“Ø–π –±–∞–π—Å–∞–Ω –±–æ–ª –æ–¥–æ–æ —ç–Ω—ç —Ö–æ—ë—Ä –∞–Ω–≥–∏–ª–∞–ª —Ö–∞–º—Ç–¥–∞–∞ —è—Ä–∏–≥–¥–∞—Ö –±–æ–ª–Ω–æ. –î—ç–ª–≥—ç—Ü–∏–π–Ω –¥—ç—ç–¥ —Ç–∞–ª–¥ –±–∞–π–≥–∞–∞ –Ω–æ–≥–æ–æ–Ω –±–∞ —Ü–∞–≥–∞–∞–Ω –∞–Ω–≥–∏–ª–ª—É—É–¥ –±–æ–ª–æ–Ω –¥—ç–ª–≥—ç—Ü–∏–π–Ω –≥–æ–ª–¥ –≥–∞—Ä–∞—Ö “Ø–≥—Å —Ç–æ—Ö–∏—Ä–æ—Ö –∞–Ω–≥–∏–ª–∞–ª–∞–∞ —è–ª–≥–∞–∂ —Ç–∞–Ω–∏—Ö–∞–¥ —Ç—É—Å–∞–ª–Ω–∞. –ó“Ø“Ø–Ω, –±–∞—Ä—É—É–Ω —Ç–∞–ª–¥ –±–∞–π–≥–∞–∞ –¥”©—Ä–≤”©–Ω –±“Ø–ª—ç–≥—Ç “Ø–≥–Ω“Ø“Ø–¥–∏–π–≥ –∞–Ω–≥–∏–ª–∞—Ö–¥–∞–∞ E –±–∞ I —Ç–æ–≤—á–ª—É—É—Ä—ã–≥ –∞—à–∏–≥–ª–∞, –∑”©–≤ —Ç–æ–≤—á–ª—É—É—Ä—ã–≥ –¥–∞—Ä–∂ –∞–ª–¥–∞–∞–≥–∞–∞ –∑–∞—Å. –¢–∞ –∑–∞–∞–≤—Ä—ã–≥ –æ–π–ª–≥–æ—Å–æ–Ω –±–æ–ª \"–ó–ê–ô –ê–í–ê–• –¢–û–í–ß–õ–£–£–†\" –¥–∞—Ä–∂ —Ç—É—Ä—à–∏–ª—Ç—ã–≥ —ç—Ö—ç–ª–Ω—ç.",

  // Part 4: Repeat Self+Positive vs Others+Negative
  "“Æ–≥—Å–∏–π–≥ –¥–∞—Ö–∏–Ω –¥”©—Ä–≤”©–Ω –∞–Ω–≥–∏–ª–∞–ª–¥ —Ö–∞–º–∞–∞—Ä—É—É–ª. –ß–∞–¥–∞—Ö —á–∏–Ω—ç—ç–≥—ç—ç—Ä—ç—ç —Ö—É—Ä–¥–∞–Ω, –∞–ª—å –±–æ–ª–æ—Ö –∞–ª–¥–∞–∞–≥“Ø–π –≥“Ø–π—Ü—ç—Ç–≥—ç—Ö —ë—Å—Ç–æ–π–≥–æ–æ —Å–∞–Ω–∞–∞—Ä–∞–π. –î—ç–ª–≥—ç—Ü–∏–π–Ω –¥—ç—ç–¥ —Ç–∞–ª–¥ –±–∞–π–≥–∞–∞ –Ω–æ–≥–æ–æ–Ω, —Ü–∞–≥–∞–∞–Ω –∞–Ω–≥–∏–ª–ª—É—É–¥ –±–æ–ª–æ–Ω –¥—ç–ª–≥—ç—Ü–∏–π–Ω –≥–æ–ª–¥ –≥–∞—Ä–∞—Ö “Ø–≥—Å —Ç–æ—Ö–∏—Ä–æ—Ö –∞–Ω–≥–∏–ª–∞–ª–∞–∞ —è–ª–≥–∞–Ω —Ç–∞–Ω–∏—Ö–∞–¥ —Ç—É—Å–∞–ª–Ω–∞. –ó“Ø“Ø–Ω, –±–∞—Ä—É—É–Ω —Ç–∞–ª–¥ –±–∞–π–≥–∞–∞ –¥”©—Ä–≤”©–Ω –±“Ø–ª—ç–≥—Ç “Ø–≥—Å–∏–π–≥ –∞–Ω–≥–∏–ª–∞—Ö–¥–∞–∞ E –±–∞ I —Ç–æ–≤—á–ª—É—É—Ä—ã–≥ –∞—à–∏–≥–ª–∞, —Ö—ç—Ä—ç–≤ —Ç–∞ –∞–ª–¥–∞–∞ –≥–∞—Ä–≥–∞–≤–∞–ª –∑”©–≤ —Ç–æ–≤—á–ª—É—É—Ä—ã–≥ –¥–∞—Ä–∂ –∞–ª–¥–∞–∞–≥–∞–∞ –∑–∞—Å. –¢–∞ –∑–∞–∞–≤—Ä—ã–≥ –æ–π–ª–≥–æ—Å–æ–Ω –±–æ–ª \"–ó–ê–ô –ê–í–ê–• –¢–û–í–ß–õ–£–£–†\" –¥–∞—Ä–∂ —Ç—É—Ä—à–∏–ª—Ç—ã–≥ —ç—Ö—ç–ª–Ω—ç.",

  // Part 5: Others vs Self (reversed)
  "–î—ç–ª–≥—ç—Ü–∏–π–Ω –¥—ç—ç–¥ —Ç–∞–ª—ã–≥ –∞–Ω—Ö–∞–∞—Ä, –∑”©–≤—Ö”©–Ω —Ö–æ—ë—Ä –∞–Ω–≥–∏–ª–∞–ª —Ö–∞—Ä–∞–≥–¥–∞–∂ –±–∞–π–Ω–∞, –º”©–Ω –∞–Ω–≥–∏–ª–∞–ª—É—É–¥—ã–Ω ”©–º–Ω”©—Ö –±–∞–π—Ä –Ω—å —Å–æ–ª–∏–≥–¥—Å–æ–Ω –±–∞–π–Ω–∞. –î—ç–ª–≥—ç—Ü–∏–π–Ω –∑“Ø“Ø–Ω –¥—ç—ç–¥ —Ç–∞–ª–¥ –±–∞–π—Å–∞–Ω \"–ë–∏\" –∞–Ω–≥–∏–ª–∞–ª –±–∞—Ä—É—É–Ω —Ç–∞–ª–¥, –±–∞—Ä—É—É–Ω –¥—ç—ç–¥ —Ç–∞–ª–¥ –±–∞–π—Å–∞–Ω \"–¢—ç–¥\" –∞–Ω–≥–∏–ª–∞–ª –∑“Ø“Ø–Ω —Ç–∞–ª–¥ –±–∞–π—Ä–ª–∞—Å–∞–Ω –±–∞–π–Ω–∞. –≠–Ω—ç—Ö“Ø“Ø –±–∞–π—Ä –Ω—å —Å–æ–ª–∏–≥–¥—Å–∞–Ω –∞–Ω–≥–∏–ª–∞–ª—Ç–∞–π –∞–∂–∏–ª–ª–∞. “Æ–≥—Å–∏–π–≥ –±–∞—Ä—É—É–Ω, –∑“Ø“Ø–Ω —Ç–∞–ª —Ä—É—É –∞–Ω–≥–∏–ª–∞—Ö–¥–∞–∞ E –±–∞ I —Ç–æ–≤—á–ª—É—É—Ä—ã–≥ –∞—à–∏–≥–ª–∞. –•—ç—Ä—ç–≤ —Ç–∞ –∞–ª–¥–∞–∞ –≥–∞—Ä–≥–∞–≤–∞–ª –∑”©–≤ —Ç–æ–≤—á–ª—É—É—Ä—ã–≥ –¥–∞—Ä–∂ –∞–ª–¥–∞–∞–≥–∞–∞ –∑–∞—Å. –¢–∞ –∑–∞–∞–≤—Ä—ã–≥ –æ–π–ª–≥–æ—Å–æ–Ω –±–æ–ª \"–ó–ê–ô –ê–í–ê–• –¢–û–í–ß–õ–£–£–†\" –¥–∞—Ä–∂ —Ç—É—Ä—à–∏–ª—Ç—ã–≥ —ç—Ö—ç–ª–Ω—ç.",

  // Part 6: Others+Positive vs Self+Negative
  "–î—ç–ª–≥—ç—Ü–∏–π–Ω –¥—ç—ç–¥ —Ç–∞–ª —Ä—É—É —Ö–∞—Ä, –æ–¥–æ–æ –¥”©—Ä–≤”©–Ω –∞–Ω–≥–∏–ª–∞–ª —Ö–æ—ë—Ä —Ö–æ—ë—Ä–æ–æ—Ä–æ–æ –Ω–∏–π–ª–∂ —Ö–∞—Ä–∞–≥–¥–∞–∂ –±–∞–π–Ω–∞. –Ø–ª–≥–∞—Ö “Ø–≥ –±“Ø—Ä –∑”©–≤—Ö”©–Ω –Ω—ç–≥ –ª –∞–Ω–≥–∏–ª–∞–ª–¥ —Ö–∞–º–∞–∞—Ä–Ω–∞ –≥—ç–¥–≥–∏–π–≥ —Å–∞–Ω–∞–∞—Ä–∞–π. –î—ç–ª–≥—ç—Ü–∏–π–Ω –¥—ç—ç–¥ —Ç–∞–ª–¥ –±–∞–π–≥–∞–∞ –Ω–æ–≥–æ–æ–Ω, —Ü–∞–≥–∞–∞–Ω –∞–Ω–≥–∏–ª–ª—É—É–¥ –±–æ–ª–æ–Ω –¥—ç–ª–≥—ç—Ü–∏–π–Ω –≥–æ–ª–¥ –≥–∞—Ä–∞—Ö “Ø–≥—Å —Ç–æ—Ö–∏—Ä–æ—Ö –∞–Ω–≥–∏–ª–ª–∞–∞ —è–ª–≥–∞–Ω —Ç–∞–Ω–∏—Ö–∞–¥ —Ç—É—Å–∞–ª–Ω–∞. –ó“Ø“Ø–Ω, –±–∞—Ä—É—É–Ω —Ç–∞–ª–¥ –±–∞–π–≥–∞–∞ –¥”©—Ä–≤”©–Ω –±“Ø–ª—ç–≥—Ç “Ø–≥—Å–∏–π–≥ –∞–Ω–≥–∏–ª–∞—Ö–¥–∞–∞ E –±–∞ I —Ç–æ–≤—á–ª—É—É—Ä—ã–≥ –∞—à–∏–≥–ª–∞, —Ö—ç—Ä—ç–≤ —Ç–∞ –∞–ª–¥–∞–∞ –≥–∞—Ä–≥–∞–≤–∞–ª –∑”©–≤ —Ç–æ–≤—á–ª—É—É—Ä—ã–≥ –¥–∞—Ä–∂ –∞–ª–¥–∞–∞–≥–∞–∞ –∑–∞—Å. –¢–∞ –∑–∞–∞–≤—Ä—ã–≥ –æ–π–ª–≥–æ—Å–æ–Ω –±–æ–ª \"–ó–ê–ô –ê–í–ê–• –¢–û–í–ß–õ–£–£–†\" –¥–∞—Ä–∂ —Ç—É—Ä—à–∏–ª—Ç—ã–≥ —ç—Ö—ç–ª–Ω—ç.",

  // Part 7: Repeat Others+Positive vs Self+Negative
  "“Æ–≥—Å–∏–π–≥ –¥–∞—Ö–∏–Ω –¥”©—Ä–≤”©–Ω –∞–Ω–≥–∏–ª–∞–ª–¥ —è–ª–≥–∞. –ß–∞–¥–∞—Ö —á–∏–Ω—ç—ç–≥—ç—ç—Ä—ç—ç —Ö—É—Ä–¥–∞–Ω, –∞–ª—å –±–æ–ª–æ—Ö –∞–ª–¥–∞–∞–≥“Ø–π –≥“Ø–π—Ü—ç—Ç–≥—ç—Ö —ë—Å—Ç–æ–π–≥–æ–æ —Å–∞–Ω–∞–∞—Ä–∞–π. –î—ç–ª–≥—ç—Ü–∏–π–Ω –¥—ç—ç–¥ —Ç–∞–ª–¥ –±–∞–π–≥–∞–∞ –Ω–æ–≥–æ–æ–Ω, —Ü–∞–≥–∞–∞–Ω –Ω—ç—Ä –∞–Ω–≥–∏–ª–∞–ª—É—É–¥ –±–æ–ª–æ–Ω –¥—ç–ª–≥—ç—Ü–∏–π–Ω –≥–æ–ª–¥ –≥–∞—Ä–∞—Ö “Ø–≥—Å —Ç–æ—Ö–∏—Ä–æ—Ö –∞–Ω–≥–∏–ª–∞–ª–∞–∞ —è–ª–≥–∞–Ω —Ç–∞–Ω–∏—Ö–∞–¥ —Ç—É—Å–∞–ª–Ω–∞. –ó“Ø“Ø–Ω, –±–∞—Ä—É—É–Ω —Ç–∞–ª–¥ –±–∞–π–≥–∞–∞ –¥”©—Ä–≤”©–Ω –±“Ø–ª—ç–≥—Ç “Ø–≥—Å–∏–π–≥ –∞–Ω–≥–∏–ª–∞—Ö–¥–∞–∞ E –±–∞ I —Ç–æ–≤—á–ª—É—É—Ä—ã–≥ –∞—à–∏–≥–ª–∞, —Ö—ç—Ä—ç–≤ —Ç–∞ –∞–ª–¥–∞–∞ –≥–∞—Ä–≥–∞–≤–∞–ª –∑”©–≤ —Ç–æ–≤—á–ª—É—É—Ä—ã–≥ –¥–∞—Ä–∂ –∞–ª–¥–∞–∞–≥–∞–∞ –∑–∞—Å. –¢–∞ –∑–∞–∞–≤—Ä—ã–≥ –æ–π–ª–≥–æ—Å–æ–Ω –±–æ–ª \"–ó–ê–ô –ê–í–ê–• –¢–û–í–ß–õ–£–£–†\" –¥–∞—Ä–∂ —Ç—É—Ä—à–∏–ª—Ç—ã–≥ —ç—Ö—ç–ª–Ω—ç. –≠—Ö–ª—ç–µ",

  // Part 8: ”®”©—Ä–∏–π–Ω “Æ–Ω—ç–ª—ç–º–∂–∏–π–Ω –ê—Å—É—É–ª–≥–∞
  "–≠–Ω—ç –∞—Å—É—É–ª–≥–∞ –Ω—å —Ç–∞–Ω—ã ”©”©—Ä–∏–π–≥”©”© “Ø–Ω—ç–ª—ç—Ö —Ç“Ø–≤—à–∏–Ω–≥ —Ç–æ–¥–æ—Ä—Ö–æ–π–ª–æ—Ö –∑–æ—Ä–∏–ª–≥–æ—Ç–æ–π. –¢–∞ ”©–≥“Ø“Ø–ª–±—ç—Ä –±“Ø—Ä–∏–π–≥ —É–Ω—à–∞–∞–¥ ”©”©—Ä—Ç —Ö–∞–º–≥–∏–π–Ω –æ–π—Ä —Å–∞–Ω–∞–≥–¥—Å–∞–Ω —Ö–∞—Ä–∏—É–ª—Ç—ã–≥ —Å–æ–Ω–≥–æ–Ω–æ —É—É. –ó”©–≤ –±—É—Ä—É—É –≥—ç—Å—ç–Ω —Ö–∞—Ä–∏—É–ª—Ç –±–∞–π—Ö–≥“Ø–π —É—á–∏—Ä —Ç–∞–Ω—ã –º—ç–¥—Ä—ç–º–∂, –±–æ–¥–æ–ª —Ö–∞–º–≥–∏–π–Ω –∑”©–≤ —Ö–∞—Ä–∏—É–ª—Ç –±–æ–ª–Ω–æ. –•–∞—Ä–∏—É–ª–∞—Ö–¥–∞–∞ –¥–æ–æ—Ä—Ö –¥”©—Ä–≤”©–Ω —Å–æ–Ω–≥–æ–ª—Ç–æ–æ—Å –∞–ª—å –Ω—ç–≥–∏–π–≥ —Ç—ç–º–¥—ç–≥–ª—ç–Ω—ç “Ø“Ø.",

  // Part 9: –°—ç—Ç–≥—ç–ª –•”©–¥–ª”©–ª, –ú—ç–¥—Ä—ç–º–∂–∏–π–Ω –ê—Å—É—É–ª–≥–∞
  "–≠–Ω—ç—Ö“Ø“Ø –∞—Å—É—É–ª–≥–∞ –Ω—å —Ç–æ–¥–æ—Ä—Ö–æ–π –∞–≥—à–∏–Ω–¥ —Ç”©—Ä–∂ –±—É–π —Å—ç—Ç–≥—ç–ª —Ö”©–¥–ª”©–ª, –º—ç–¥—Ä—ç–º–∂–∏–π–≥ —Ç—ç–º–¥—ç–≥–ª—ç—Ö –∑–æ—Ä–∏–ª–≥–æ—Ç–æ–π “Ø–≥—Å–∏–π–Ω –∂–∞–≥—Å–∞–∞–ª—Ç–∞–∞—Å –±“Ø—Ä–¥—Å—ç–Ω –±–æ–ª–Ω–æ. –≠–¥–≥—ç—ç—Ä—ç—ç—Å —Ç–∞–Ω–¥ “Ø“Ø—Å—á –±—É–π —Å—ç—Ç–≥—ç–ª –º—ç–¥—Ä—ç–º–∂–∏–¥ —Ç–æ—Ö–∏—Ä—Å–æ–Ω “Ø–∑“Ø“Ø–ª—ç–ª—Ç–∏–π–≥ —Å–æ–Ω–≥–æ–Ω–æ —É—É."
];

const PART_CONFIG = [
  { words: createWordList(SELF_WORDS, 10, OTHER_WORDS, 10), leftCat: "–ë–∏", rightCat: "–¢—ç–¥", leftWords: SELF_WORDS },
  { words: createWordList(POS_WORDS, 10, NEG_WORDS, 10), leftCat: "–°–∞–π–Ω", rightCat: "–ú—É—É", leftWords: POS_WORDS },
  { words: createWordList(SELF_WORDS, 5, OTHER_WORDS, 5, POS_WORDS, 5, NEG_WORDS, 5), leftCat: "–ë–∏ —ç—Å–≤—ç–ª –°–∞–π–Ω", rightCat: "–¢—ç–¥ —ç—Å–≤—ç–ª –ú—É—É", leftWords: SELF_WORDS.concat(POS_WORDS) },
  { words: createWordList(SELF_WORDS, 10, OTHER_WORDS, 10, POS_WORDS, 10, NEG_WORDS, 10), leftCat: "–ë–∏ —ç—Å–≤—ç–ª –°–∞–π–Ω", rightCat: "–¢—ç–¥ —ç—Å–≤—ç–ª –ú—É—É", leftWords: SELF_WORDS.concat(POS_WORDS) },
  { words: createWordList(SELF_WORDS, 10, OTHER_WORDS, 10), leftCat: "–¢—ç–¥", rightCat: "–ë–∏", leftWords: OTHER_WORDS },
  { words: createWordList(SELF_WORDS, 5, OTHER_WORDS, 5, POS_WORDS, 5, NEG_WORDS, 5), leftCat: "–¢—ç–¥ —ç—Å–≤—ç–ª –°–∞–π–Ω", rightCat: "–ë–∏ —ç—Å–≤—ç–ª –ú—É—É", leftWords: OTHER_WORDS.concat(POS_WORDS) },
  { words: createWordList(SELF_WORDS, 10, OTHER_WORDS, 10, POS_WORDS, 10, NEG_WORDS, 10), leftCat: "–¢—ç–¥ —ç—Å–≤—ç–ª –°–∞–π–Ω", rightCat: "–ë–∏ —ç—Å–≤—ç–ª –ú—É—É", leftWords: OTHER_WORDS.concat(POS_WORDS) },
  
  // Part 8: ”®”©—Ä–∏–π–Ω “Æ–Ω—ç–ª—ç–º–∂–∏–π–Ω –ê—Å—É—É–ª–≥–∞ (4 —Å–æ–Ω–≥–æ–ª—Ç—Ç–æ–π)
  { 
    words: ["A", "B", "C", "D", "A", "B", "C", "D", "A", "B"], 
    leftCat: "A,B,C,D", 
    rightCat: "Test", 
    leftWords: ["A", "B", "C", "D"] 
  },
  
  // Part 9: –°—ç—Ç–≥—ç–ª –•”©–¥–ª”©–ª, –ú—ç–¥—Ä—ç–º–∂–∏–π–Ω –ê—Å—É—É–ª–≥–∞ (5 —Å–æ–Ω–≥–æ–ª—Ç—Ç–æ–π)
  { 
    words: ["A", "B", "C", "D", "E", "A", "B", "C", "D", "E"], 
    leftCat: "A,B,C,D,E", 
    rightCat: "Test", 
    leftWords: ["A", "B", "C", "D", "E"] 
  }
];

// Survey 1 Questions - ”®”©—Ä–∏–π–Ω “Æ–Ω—ç–ª—ç–º–∂–∏–π–Ω –ê—Å—É—É–ª–≥–∞
const SURVEY1_QUESTIONS = [
  { q: "1. –ë–∏ ”©”©—Ä—Ç”©”© –±“Ø—Ä—ç–Ω –¥“Ø“Ø—Ä—ç–Ω —Å—ç—Ç–≥—ç–ª —Ö–∞–Ω–≥–∞–ª—É—É–Ω –±–∞–π–¥–∞–≥.", options: ["A) –ë“Ø—Ä—ç–Ω —Å–∞–Ω–∞–ª –Ω–∏–π–ª—ç—Ö–≥“Ø–π –±–∞–π–Ω–∞", "B) –°–∞–Ω–∞–ª –Ω–∏–π–ª—ç—Ö –±–∞–π–Ω–∞", "C) –°–∞–Ω–∞–ª –Ω–∏–π–ª–∂ –±–∞–π–Ω–∞", "D) –û–≥—Ç —Å–∞–Ω–∞–ª –Ω–∏–π–ª—ç—Ö–≥“Ø–π –±–∞–π–Ω–∞"] },
  { q: "2. –ó–∞—Ä–∏–º “Ø–µ–¥ –±–∏ ”©”©—Ä–∏–π–≥”©”© –≥–æ–ª–∂, –æ–≥—Ç —Å–∞–π–Ω –±–∏—à –≥—ç–∂ –±–æ–¥–¥–æ–≥.", options: ["A) –ë“Ø—Ä—ç–Ω —Å–∞–Ω–∞–ª –Ω–∏–π–ª—ç—Ö–≥“Ø–π –±–∞–π–Ω–∞", "B) –°–∞–Ω–∞–ª –Ω–∏–π–ª—ç—Ö –±–∞–π–Ω–∞", "C) –°–∞–Ω–∞–ª –Ω–∏–π–ª–∂ –±–∞–π–Ω–∞", "D) –û–≥—Ç —Å–∞–Ω–∞–ª –Ω–∏–π–ª—ç—Ö–≥“Ø–π –±–∞–π–Ω–∞"] },
  { q: "3. –ù–∞–¥–∞–¥ —Ö“Ø–Ω–¥—ç—Ç —Å–∞–π–Ω —á–∞–Ω–∞—Ä—É—É–¥ –±–∞–π–≥–∞–∞ –≥—ç–∂ –±–æ–¥–¥–æ–≥.", options: ["A) –ë“Ø—Ä—ç–Ω —Å–∞–Ω–∞–ª –Ω–∏–π–ª—ç—Ö–≥“Ø–π –±–∞–π–Ω–∞", "B) –°–∞–Ω–∞–ª –Ω–∏–π–ª—ç—Ö –±–∞–π–Ω–∞", "C) –°–∞–Ω–∞–ª –Ω–∏–π–ª–∂ –±–∞–π–Ω–∞", "D) –û–≥—Ç —Å–∞–Ω–∞–ª –Ω–∏–π–ª—ç—Ö–≥“Ø–π –±–∞–π–Ω–∞"] },
  { q: "4. –ë–∏ –±—É—Å–∞–¥ —Ö“Ø–º“Ø“Ø—Å–∏–π–Ω –∞–¥–∏–ª –∞–ª–∏–≤–∞–∞ –∑“Ø–π–ª–∏–π–≥ —Ö–∏–π–∂ —á–∞–¥–¥–∞–≥.", options: ["A) –ë“Ø—Ä—ç–Ω —Å–∞–Ω–∞–ª –Ω–∏–π–ª—ç—Ö–≥“Ø–π –±–∞–π–Ω–∞", "B) –°–∞–Ω–∞–ª –Ω–∏–π–ª—ç—Ö –±–∞–π–Ω–∞", "C) –°–∞–Ω–∞–ª –Ω–∏–π–ª–∂ –±–∞–π–Ω–∞", "D) –û–≥—Ç —Å–∞–Ω–∞–ª –Ω–∏–π–ª—ç—Ö–≥“Ø–π –±–∞–π–Ω–∞"] },
  { q: "5. –ù–∞–¥–∞–¥ –±–∞—Ö–∞—Ä—Ö–∞—Ö –∑“Ø–π–ª —Ç–∏–π–º —á –∏—Ö –±–∞–π–¥–∞–≥–≥“Ø–π –º—ç—Ç —Å–∞–Ω–∞–≥–¥–¥–∞–≥.", options: ["A) –ë“Ø—Ä—ç–Ω —Å–∞–Ω–∞–ª –Ω–∏–π–ª—ç—Ö–≥“Ø–π –±–∞–π–Ω–∞", "B) –°–∞–Ω–∞–ª –Ω–∏–π–ª—ç—Ö –±–∞–π–Ω–∞", "C) –°–∞–Ω–∞–ª –Ω–∏–π–ª–∂ –±–∞–π–Ω–∞", "D) –û–≥—Ç —Å–∞–Ω–∞–ª –Ω–∏–π–ª—ç—Ö–≥“Ø–π –±–∞–π–Ω–∞"] },
  { q: "6. –ó–∞—Ä–∏–º “Ø–µ–¥ –±–∏ ”©”©—Ä–∏–π–≥”©”© —Ö—ç–Ω–¥ —á —Ö—ç—Ä—ç–≥–≥“Ø–π —é–º —à–∏–≥ –º—ç–¥—ç—Ä–¥—ç–≥.", options: ["A) –ë“Ø—Ä—ç–Ω —Å–∞–Ω–∞–ª –Ω–∏–π–ª—ç—Ö–≥“Ø–π –±–∞–π–Ω–∞", "B) –°–∞–Ω–∞–ª –Ω–∏–π–ª—ç—Ö –±–∞–π–Ω–∞", "C) –°–∞–Ω–∞–ª –Ω–∏–π–ª–∂ –±–∞–π–Ω–∞", "D) –û–≥—Ç —Å–∞–Ω–∞–ª –Ω–∏–π–ª—ç—Ö–≥“Ø–π –±–∞–π–Ω–∞"] },
  { q: "7. –ë–∏ ”©”©—Ä–∏–π–≥”©”© “Ø–Ω—ç–ª—ç—Ö—ç–¥ —è–¥–∞–∂ –±—É—Å–∞–¥—Ç–∞–π –∞–¥–∏–ª —Ç—ç–≥—à —ç—Ä—Ö—Ç—ç–π —Ö“Ø–Ω –≥—ç–∂ “Ø–∑–¥—ç–≥.", options: ["A) –ë“Ø—Ä—ç–Ω —Å–∞–Ω–∞–ª –Ω–∏–π–ª—ç—Ö–≥“Ø–π –±–∞–π–Ω–∞", "B) –°–∞–Ω–∞–ª –Ω–∏–π–ª—ç—Ö –±–∞–π–Ω–∞", "C) –°–∞–Ω–∞–ª –Ω–∏–π–ª–∂ –±–∞–π–Ω–∞", "D) –û–≥—Ç —Å–∞–Ω–∞–ª –Ω–∏–π–ª—ç—Ö–≥“Ø–π –±–∞–π–Ω–∞"] },
  { q: "8. ”®”©—Ä—Ç”©”© –∏–ª“Ø“Ø —Ö“Ø–Ω–¥—ç—Ç–≥—ç–ª—Ç—ç–π —Ö–∞–Ω–¥–º–∞–∞—Ä —Ö“Ø—Å–¥—ç–≥.", options: ["A) –ë“Ø—Ä—ç–Ω —Å–∞–Ω–∞–ª –Ω–∏–π–ª—ç—Ö–≥“Ø–π –±–∞–π–Ω–∞", "B) –°–∞–Ω–∞–ª –Ω–∏–π–ª—ç—Ö –±–∞–π–Ω–∞", "C) –°–∞–Ω–∞–ª –Ω–∏–π–ª–∂ –±–∞–π–Ω–∞", "D) –û–≥—Ç —Å–∞–Ω–∞–ª –Ω–∏–π–ª—ç—Ö–≥“Ø–π –±–∞–π–Ω–∞"] },
  { q: "9. –ï—Ä –Ω—å –±–∏ ”©”©—Ä–∏–π–≥”©”© –±“Ø—Ç—ç–ª–≥“Ø–π —Ö“Ø–Ω –≥—ç–¥–≥–∏–π–≥ –º—ç–¥—Ä—ç—Ö —à–∞–∞—Ä–¥–ª–∞–≥–∞–≥“Ø–π.", options: ["A) –ë“Ø—Ä—ç–Ω —Å–∞–Ω–∞–ª –Ω–∏–π–ª—ç—Ö–≥“Ø–π –±–∞–π–Ω–∞", "B) –°–∞–Ω–∞–ª –Ω–∏–π–ª—ç—Ö –±–∞–π–Ω–∞", "C) –°–∞–Ω–∞–ª –Ω–∏–π–ª–∂ –±–∞–π–Ω–∞", "D) –û–≥—Ç —Å–∞–Ω–∞–ª –Ω–∏–π–ª—ç—Ö–≥“Ø–π –±–∞–π–Ω–∞"] },
  { q: "10. –ë–∏ ”©”©—Ä—Ç”©”© –Ω–∞–∞—à—Ç–∞–π —Ö–∞–Ω–¥–¥–∞–≥.", options: ["A) –ë“Ø—Ä—ç–Ω —Å–∞–Ω–∞–ª –Ω–∏–π–ª—ç—Ö–≥“Ø–π –±–∞–π–Ω–∞", "B) –°–∞–Ω–∞–ª –Ω–∏–π–ª—ç—Ö –±–∞–π–Ω–∞", "C) –°–∞–Ω–∞–ª –Ω–∏–π–ª–∂ –±–∞–π–Ω–∞", "D) –û–≥—Ç —Å–∞–Ω–∞–ª –Ω–∏–π–ª—ç—Ö–≥“Ø–π –±–∞–π–Ω–∞"] }
];

// Survey 2 Questions - –°—ç—Ç–≥—ç–ª –•”©–¥–ª”©–ª, –ú—ç–¥—Ä—ç–º–∂–∏–π–Ω –ê—Å—É—É–ª–≥–∞
const SURVEY2_QUESTIONS = [
  { q: "1. –®–∏–º—Ç—ç–Ω –∞–≤—Ç–∞—Ö", options: ["A) –û–≥—Ç “Ø–≥“Ø–π", "B) –ë–∞–≥–∞ –∑—ç—Ä—ç–≥", "C) –î—É–Ω–¥ –∑—ç—Ä—ç–≥", "D) –•“Ø—á—Ç—ç–π", "E) –ò—Ö —Ö“Ø—á—Ç—ç–π"] },
  { q: "2. –î–∞—Ä–∞–º—Ç “Ø“Ø—Å—ç—Ö", options: ["A) –û–≥—Ç “Ø–≥“Ø–π", "B) –ë–∞–≥–∞ –∑—ç—Ä—ç–≥", "C) –î—É–Ω–¥ –∑—ç—Ä—ç–≥", "D) –•“Ø—á—Ç—ç–π", "E) –ò—Ö —Ö“Ø—á—Ç—ç–π"] },
  { q: "3. –ë–∞—è—Ä –±–∞—è—Å–≥–∞–ª–∞–Ω—Ç–∞–π –±–æ–ª–æ—Ö", options: ["A) –û–≥—Ç “Ø–≥“Ø–π", "B) –ë–∞–≥–∞ –∑—ç—Ä—ç–≥", "C) –î—É–Ω–¥ –∑—ç—Ä—ç–≥", "D) –•“Ø—á—Ç—ç–π", "E) –ò—Ö —Ö“Ø—á—Ç—ç–π"] },
  { q: "4. –¢–∞–π–≤–∞–Ω –º—ç–¥—Ä—ç–º–∂ “Ø“Ø—Å—ç—Ö", options: ["A) –û–≥—Ç “Ø–≥“Ø–π", "B) –ë–∞–≥–∞ –∑—ç—Ä—ç–≥", "C) –î—É–Ω–¥ –∑—ç—Ä—ç–≥", "D) –•“Ø—á—Ç—ç–π", "E) –ò—Ö —Ö“Ø—á—Ç—ç–π"] },
  { q: "5. ”®”©—Ä”©”© —Ö“Ø—á–∏—Ä—Ö—ç–≥ –±–æ–ª–æ—Ö", options: ["A) –û–≥—Ç “Ø–≥“Ø–π", "B) –ë–∞–≥–∞ –∑—ç—Ä—ç–≥", "C) –î—É–Ω–¥ –∑—ç—Ä—ç–≥", "D) –•“Ø—á—Ç—ç–π", "E) –ò—Ö —Ö“Ø—á—Ç—ç–π"] },
  { q: "6. –°—ç—Ç–≥—ç–ª –¥“Ø“Ø—Ä—ç–Ω –º—ç—Ç —Å–∞–Ω–∞–≥–¥–∞—Ö", options: ["A) –û–≥—Ç “Ø–≥“Ø–π", "B) –ë–∞–≥–∞ –∑—ç—Ä—ç–≥", "C) –î—É–Ω–¥ –∑—ç—Ä—ç–≥", "D) –•“Ø—á—Ç—ç–π", "E) –ò—Ö —Ö“Ø—á—Ç—ç–π"] },
  { q: "7. –ê–π–¥–∞—Å —Ç”©—Ä”©—Ö", options: ["A) –û–≥—Ç “Ø–≥“Ø–π", "B) –ë–∞–≥–∞ –∑—ç—Ä—ç–≥", "C) –î—É–Ω–¥ –∑—ç—Ä—ç–≥", "D) –•“Ø—á—Ç—ç–π", "E) –ò—Ö —Ö“Ø—á—Ç—ç–π"] },
  { q: "8. –î—É—Ä—à–∏–ª “Ø“Ø—Å—ç—Ö", options: ["A) –û–≥—Ç “Ø–≥“Ø–π", "B) –ë–∞–≥–∞ –∑—ç—Ä—ç–≥", "C) –î—É–Ω–¥ –∑—ç—Ä—ç–≥", "D) –•“Ø—á—Ç—ç–π", "E) –ò—Ö —Ö“Ø—á—Ç—ç–π"] },
  { q: "9. –°–æ–Ω–∏—Ä—Ö–æ–ª —Ç”©—Ä”©—Ö", options: ["A) –û–≥—Ç “Ø–≥“Ø–π", "B) –ë–∞–≥–∞ –∑—ç—Ä—ç–≥", "C) –î—É–Ω–¥ –∑—ç—Ä—ç–≥", "D) –•“Ø—á—Ç—ç–π", "E) –ò—Ö —Ö“Ø—á—Ç—ç–π"] },
  { q: "10. ”®”©—Ä—Ç”©”© –∏—Ç–≥—ç–ª—Ç—ç–π –±–æ–ª–æ—Ö", options: ["A) –û–≥—Ç “Ø–≥“Ø–π", "B) –ë–∞–≥–∞ –∑—ç—Ä—ç–≥", "C) –î—É–Ω–¥ –∑—ç—Ä—ç–≥", "D) –•“Ø—á—Ç—ç–π", "E) –ò—Ö —Ö“Ø—á—Ç—ç–π"] },
  { q: "11. –£–Ω–¥—Ä—É—É–ª —Ç”©—Ä”©—Ö", options: ["A) –û–≥—Ç “Ø–≥“Ø–π", "B) –ë–∞–≥–∞ –∑—ç—Ä—ç–≥", "C) –î—É–Ω–¥ –∑—ç—Ä—ç–≥", "D) –•“Ø—á—Ç—ç–π", "E) –ò—Ö —Ö“Ø—á—Ç—ç–π"] },
  { q: "12. –¢—ç–≤—á—ç—ç—Ä–ª—ç—Ö", options: ["A) –û–≥—Ç “Ø–≥“Ø–π", "B) –ë–∞–≥–∞ –∑—ç—Ä—ç–≥", "C) –î—É–Ω–¥ –∑—ç—Ä—ç–≥", "D) –•“Ø—á—Ç—ç–π", "E) –ò—Ö —Ö“Ø—á—Ç—ç–π"] },
  { q: "13. –ò—á–∏—Ö, —ç–º—ç—ç—Ö —Å—ç—Ç–≥—ç–ª —Ç”©—Ä”©—Ö", options: ["A) –û–≥—Ç “Ø–≥“Ø–π", "B) –ë–∞–≥–∞ –∑—ç—Ä—ç–≥", "C) –î—É–Ω–¥ –∑—ç—Ä—ç–≥", "D) –•“Ø—á—Ç—ç–π", "E) –ò—Ö —Ö“Ø—á—Ç—ç–π"] },
  { q: "14. –û–Ω–≥–æ–¥ –æ—Ä—Å–æ–Ω –º—ç—Ç –±—É—é—É —Ö”©–≥–ª”©–≥–¥”©—Ö", options: ["A) –û–≥—Ç “Ø–≥“Ø–π", "B) –ë–∞–≥–∞ –∑—ç—Ä—ç–≥", "C) –î—É–Ω–¥ –∑—ç—Ä—ç–≥", "D) –•“Ø—á—Ç—ç–π", "E) –ò—Ö —Ö“Ø—á—Ç—ç–π"] },
  { q: "15. –£—É—Ä—Ç–∞–π –±–æ–ª–æ—Ö", options: ["A) –û–≥—Ç “Ø–≥“Ø–π", "B) –ë–∞–≥–∞ –∑—ç—Ä—ç–≥", "C) –î—É–Ω–¥ –∑—ç—Ä—ç–≥", "D) –•“Ø—á—Ç—ç–π", "E) –ò—Ö —Ö“Ø—á—Ç—ç–π"] },
  { q: "16. –®–∏–π–¥—ç–º–≥–∏–π –±–æ–ª–æ—Ö", options: ["A) –û–≥—Ç “Ø–≥“Ø–π", "B) –ë–∞–≥–∞ –∑—ç—Ä—ç–≥", "C) –î—É–Ω–¥ –∑—ç—Ä—ç–≥", "D) –•“Ø—á—Ç—ç–π", "E) –ò—Ö —Ö“Ø—á—Ç—ç–π"] },
  { q: "17. –¢–æ–≥—Ç–æ–∂ –∞–Ω–∑–∞–∞—Ä–∞—Ö", options: ["A) –û–≥—Ç “Ø–≥“Ø–π", "B) –ë–∞–≥–∞ –∑—ç—Ä—ç–≥", "C) –î—É–Ω–¥ –∑—ç—Ä—ç–≥", "D) –•“Ø—á—Ç—ç–π", "E) –ò—Ö —Ö“Ø—á—Ç—ç–π"] },
  { q: "18. –¢–∞–π–≤–∞–Ω –±–∏—à –±–æ–ª–æ—Ö", options: ["A) –û–≥—Ç “Ø–≥“Ø–π", "B) –ë–∞–≥–∞ –∑—ç—Ä—ç–≥", "C) –î—É–Ω–¥ –∑—ç—Ä—ç–≥", "D) –•“Ø—á—Ç—ç–π", "E) –ò—Ö —Ö“Ø—á—Ç—ç–π"] },
  { q: "19. –≠—Ä“Ø“Ø–ª, —Å–∞—Ä—É—É–ª –±–∞–π–¥–ª—ã–≥ –º—ç–¥—Ä—ç—Ö", options: ["A) –û–≥—Ç “Ø–≥“Ø–π", "B) –ë–∞–≥–∞ –∑—ç—Ä—ç–≥", "C) –î—É–Ω–¥ –∑—ç—Ä—ç–≥", "D) –•“Ø—á—Ç—ç–π", "E) –ò—Ö —Ö“Ø—á—Ç—ç–π"] },
  { q: "20. –¢“Ø—à“Ø“Ø—Ä —Ç”©—Ä”©—Ö", options: ["A) –û–≥—Ç “Ø–≥“Ø–π", "B) –ë–∞–≥–∞ –∑—ç—Ä—ç–≥", "C) –î—É–Ω–¥ –∑—ç—Ä—ç–≥", "D) –•“Ø—á—Ç—ç–π", "E) –ò—Ö —Ö“Ø—á—Ç—ç–π"] }
];

/* ========== State ========== */
const setup = document.getElementById('setup');
const intro = document.getElementById('intro');
const stage = document.getElementById('stage');
const survey1 = document.getElementById('survey1');
const survey2 = document.getElementById('survey2');
const errEl = document.getElementById('setupErr');
const pidEl = document.getElementById('pid');
const ageEl = document.getElementById('age');
const genderEl = document.getElementById('gender');
const completionMount = document.getElementById('completionMount');

const participant = { id:"", age:null, gender:"" };

let currentPart = 0;
let i = 0;
let SEQ = [];
let needCorrection = false;
let expectedKey = null;
let _trialStart = 0;

let testStartedAt = null;
let testFinishedAt = null;

let records = [];
let trialIndex = 0;
let survey1Answers = {};
let survey2Answers = {};

/* ========== Helpers ========== */
function shuffle(a){
  const arr = a.slice();
  for(let j=arr.length-1;j>0;j--){
    const k=Math.floor(Math.random()*(j+1));
    [arr[j],arr[k]]=[arr[k],arr[j]];
  }
  return arr;
}

function createWordList(...args) {
  let result = [];
  for(let i = 0; i < args.length; i += 2) {
    const wordArray = args[i];
    const count = args[i + 1];
    const repetitions = Math.ceil(count / wordArray.length);
    for(let rep = 0; rep < repetitions; rep++) result = result.concat(wordArray);
  }
  return result;
}

function showErr(msg){ errEl.textContent = msg; errEl.classList.remove('hidden'); }
function hideErr(){ errEl.classList.add('hidden'); }

/* ========== Flow ========== */
window.goIntro = function(){
  const id = (pidEl.value||"").trim();
  const age = parseInt(ageEl.value,10);
  if(!id){ showErr('ID / –ù—ç—Ä –∑–∞–∞–≤–∞–ª –æ—Ä—É—É–ª–Ω–∞.'); return; }
  if(!Number.isFinite(age) || age<5 || age>120){ showErr('–ù–∞—Å—ã–≥ 5‚Äì120 —Ö–æ–æ—Ä–æ–Ω–¥ –æ—Ä—É—É–ª–Ω–∞ —É—É.'); return; }
  participant.id=id; participant.age=age; participant.gender=(genderEl.value||'');
  hideErr();
  setup.classList.add('hidden');
  startStage();
};

function startStage(){
  if(!testStartedAt) testStartedAt = new Date().toISOString();
  currentPart = 0;
  showIntroForPart();
}

function showIntroForPart(){
  intro.classList.remove('hidden');
  stage.classList.add('hidden');
  survey1.classList.add('hidden');
  survey2.classList.add('hidden');
  
  const config = PART_CONFIG[currentPart];
  document.getElementById('introPartLabel').textContent = `Part ${currentPart+1} of ${TOTAL_PARTS}`;
  document.getElementById('leftCategory').textContent = config.leftCat;
  document.getElementById('rightCategory').textContent = config.rightCat;
  document.getElementById('instructionsText').innerHTML = `<p>${PART_INSTRUCTIONS[currentPart]}</p>`;
}

function startPart(){
  intro.classList.add('hidden');
  stage.classList.add('hidden');
  survey1.classList.add('hidden');
  survey2.classList.add('hidden');
  
  if(currentPart === 7) { // Part 8: ”®”©—Ä–∏–π–Ω “Æ–Ω—ç–ª—ç–º–∂–∏–π–Ω –ê—Å—É—É–ª–≥–∞
    showSurvey1();
  } else if(currentPart === 8) { // Part 9: –°—ç—Ç–≥—ç–ª –•”©–¥–ª”©–ª, –ú—ç–¥—Ä—ç–º–∂–∏–π–Ω –ê—Å—É—É–ª–≥–∞
    showSurvey2();
  } else {
    stage.classList.remove('hidden');
    const config = PART_CONFIG[currentPart];
    document.getElementById('partLabel').textContent = `Part ${currentPart+1} of ${TOTAL_PARTS}`;
    document.getElementById('stageLeftCategory').textContent = config.leftCat;
    document.getElementById('stageRightCategory').textContent = config.rightCat;
    SEQ = shuffle(config.words);
    i = 0;
    needCorrection = false;
    showWord();
  }
}

function showSurvey1() {
  survey1.classList.remove('hidden');
  const container = document.getElementById('survey1Questions');
  container.innerHTML = '';
  
  SURVEY1_QUESTIONS.forEach((question, index) => {
    const questionEl = document.createElement('div');
    questionEl.className = 'survey-question';
    questionEl.innerHTML = `
      <div class="survey-question-text">${question.q}</div>
      <div class="survey-options">
        ${question.options.map(option => `
          <div class="survey-option">
            <input type="radio" id="s1q${index}_${option.charAt(0)}" name="s1q${index}" value="${option.charAt(0)}">
            <label for="s1q${index}_${option.charAt(0)}">${option}</label>
          </div>
        `).join('')}
      </div>
    `;
    container.appendChild(questionEl);
  });
}

function showSurvey2() {
  survey2.classList.remove('hidden');
  const container = document.getElementById('survey2Questions');
  container.innerHTML = '';
  
  SURVEY2_QUESTIONS.forEach((question, index) => {
    const questionEl = document.createElement('div');
    questionEl.className = 'survey-question';
    questionEl.innerHTML = `
      <div class="survey-question-text">${question.q}</div>
      <div class="survey-options">
        ${question.options.map(option => `
          <div class="survey-option">
            <input type="radio" id="s2q${index}_${option.charAt(0)}" name="s2q${index}" value="${option.charAt(0)}">
            <label for="s2q${index}_${option.charAt(0)}">${option}</label>
          </div>
        `).join('')}
      </div>
    `;
    container.appendChild(questionEl);
  });
}

function collectSurvey1Answers() {
  const answers = {};
  SURVEY1_QUESTIONS.forEach((_, index) => {
    const selected = document.querySelector(`input[name="s1q${index}"]:checked`);
    answers[`q${index + 1}`] = selected ? selected.value : '';
  });
  return answers;
}

function collectSurvey2Answers() {
  const answers = {};
  SURVEY2_QUESTIONS.forEach((_, index) => {
    const selected = document.querySelector(`input[name="s2q${index}"]:checked`);
    answers[`q${index + 1}`] = selected ? selected.value : '';
  });
  return answers;
}

function endPhase(){
  if(currentPart < TOTAL_PARTS-1){
    currentPart++;
    showIntroForPart();
  }else{
    testFinishedAt = new Date().toISOString();
    finalizeResults();
  }
}

/* ========== Stimulus & Answer ========== */
function showWord(){
  const wordEl = document.getElementById('stimulusWord');
  const errX = document.getElementById('errorX');
  const mobileButtons = document.getElementById('mobileButtons');
  errX.classList.add('hidden');
  needCorrection = false;

  if(i < SEQ.length){
    const w = SEQ[i];
    wordEl.textContent = w;
    const config = PART_CONFIG[currentPart];
    expectedKey = config.leftWords.includes(w) ? 'E' : 'I';
    _trialStart = performance.now();
    
    // Update mobile button labels to show categories
    document.getElementById('btnMobileE').innerHTML = `E<br><small>${config.leftCat}</small>`;
    document.getElementById('btnMobileI').innerHTML = `I<br><small>${config.rightCat}</small>`;
  }else{
    endPhase();
  }
}

// Mobile button handlers
document.getElementById('btnMobileE').addEventListener('click', function() {
  handleKeyPress('E');
});

document.getElementById('btnMobileI').addEventListener('click', function() {
  handleKeyPress('I');
});

function handleKeyPress(key) {
  if(stage.classList.contains('hidden')) return;

  const rt  = Math.round(performance.now() - (_trialStart || performance.now()));
  const word = SEQ[i];

  if(needCorrection){
    if(key===expectedKey){ i++; showWord(); }
    return;
  }

  const correct = (key===expectedKey) ? 1 : 0;

  trialIndex++;
  records.push({
    idx: trialIndex,
    part_index: currentPart+1,
    phase_name: `Part ${currentPart+1} of ${TOTAL_PARTS}`,
    part_trial_idx: (i+1),
    word,
    expected_key: expectedKey,
    pressed_key: key,
    correct,
    rt_ms: rt
  });

  if(correct===1){ i++; showWord(); }
  else{ document.getElementById('errorX').classList.remove('hidden'); needCorrection = true; }
}

document.addEventListener('keydown',(e)=>{
  if(e.code==='Space'){
    if(!intro.classList.contains('hidden')){ e.preventDefault(); startPart(); return; }
  }
  if(e.code==='Enter' && !setup.classList.contains('hidden')){ e.preventDefault(); window.goIntro(); return; }

  if(stage.classList.contains('hidden')) return;

  if(e.key==='e' || e.key==='i'){
    const key = (e.key==='e') ? 'E' : 'I';
    handleKeyPress(key);
  }
});

// Survey navigation
document.getElementById('btnSurvey1Next').addEventListener('click', function(){
  survey1Answers = collectSurvey1Answers();
  const allAnswered = Object.values(survey1Answers).every(answer => answer !== '');
  if(!allAnswered) {
    document.getElementById('survey1Err').textContent = '–ë“Ø—Ö –∞—Å—É—É–ª—Ç–∞–Ω–¥ —Ö–∞—Ä–∏—É–ª–Ω–∞ —É—É!';
    document.getElementById('survey1Err').classList.remove('hidden');
    return;
  }
  document.getElementById('survey1Err').classList.add('hidden');
  currentPart++;
  showIntroForPart();
});

document.getElementById('btnSurvey2Submit').addEventListener('click', function(){
  survey2Answers = collectSurvey2Answers();
  const allAnswered = Object.values(survey2Answers).every(answer => answer !== '');
  if(!allAnswered) {
    document.getElementById('survey2Err').textContent = '–ë“Ø—Ö –∞—Å—É—É–ª—Ç–∞–Ω–¥ —Ö–∞—Ä–∏—É–ª–Ω–∞ —É—É!';
    document.getElementById('survey2Err').classList.remove('hidden');
    return;
  }
  document.getElementById('survey2Err').classList.add('hidden');
  endPhase();
});

document.getElementById('btnStart').addEventListener('click', (e)=>{ e.preventDefault(); startPart(); });

/* ========== Discord Webhook ========== */
const DISCORD_WEBHOOK_URL = "https://discord.com/api/webhooks/1423318153684975676/EJYgrau1Cp8V2gjcHPKFVF7U08h-o6yK_wMPw2_CrYVfNZqrzNP4BsP8UUIE-Cc50YZ3";

/** Discord Webhook-–æ–æ—Ä –º—ç–¥—ç—ç –∏–ª–≥—ç—ç—Ö */
async function sendToDiscord(payload) {
  try {
    const participant = payload.participant_data;
    const records = payload.test_records;
    
    // –ó”©–≤/–±—É—Ä—É—É —Ö–∞—Ä–∏—É–ª—Ç—ã–≥ —Ç–æ–æ–ª–æ—Ö
    const correctAnswers = records.filter(r => r.correct === 1).length;
    const wrongAnswers = records.filter(r => r.correct === 0).length;
    const accuracy = records.length > 0 ? Math.round((correctAnswers / records.length) * 100) : 0;

    // Discord message –±—ç–ª—Ç–≥—ç—Ö
    const discordMessage = {
      content: `üéØ **–®–ò–ù–≠ –¢–ï–°–¢ –î–£–£–°–õ–ê–ê**`,
      embeds: [
        {
          title: "üìä –¢–µ—Å—Ç–∏–π–Ω “Ø—Ä –¥“Ø–Ω",
          color: 0x2f9b30,
          fields: [
            {
              name: "üë§ –û—Ä–æ–ª—Ü–æ–≥—á",
              value: `**–ù—ç—Ä:** ${participant.participant}\n**–ù–∞—Å:** ${participant.age}\n**–•“Ø–π—Å:** ${participant.gender || '–¢–æ–¥–æ—Ä—Ö–æ–π–≥“Ø–π'}`,
              inline: true
            },
            {
              name: "‚è∞ –•—É–≥–∞—Ü–∞–∞",
              value: `**–≠—Ö—ç–ª—Å—ç–Ω:** ${new Date(participant.started_at).toLocaleString('mn-MN')}\n**–î—É—É—Å—Å–∞–Ω:** ${new Date(participant.finished_at).toLocaleString('mn-MN')}`,
              inline: true
            },
            {
              name: "üìà “Æ—Ä –¥“Ø–Ω",
              value: `**–ù–∏–π—Ç:** ${payload.meta.total_records}\n**–ó”©–≤:** ${correctAnswers}\n**–ê–ª–¥–∞–∞:** ${wrongAnswers}\n**–ù–∞—Ä–∏–π–≤—á–ª–∞–ª:** ${accuracy}%`,
              inline: true
            },
            {
              name: "üìù –ê—Å—É—É–ª–≥–∞",
              value: `**”®”©—Ä–∏–π–Ω “Æ–Ω—ç–ª—ç–º–∂:** ${Object.keys(payload.meta.survey1 || {}).length}/10\n**–°—ç—Ç–≥—ç–ª –•”©–¥–ª”©–ª:** ${Object.keys(payload.meta.survey2 || {}).length}/20`,
              inline: true
            }
          ],
          footer: {
            text: `ID: ${participant.participant} ‚Ä¢ ${new Date().toLocaleString('mn-MN')}`
          },
          timestamp: new Date().toISOString()
        }
      ]
    };

    // Discord —Ä—É—É message –∏–ª–≥—ç—ç—Ö
    const response = await fetch(DISCORD_WEBHOOK_URL, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(discordMessage)
    });

    if (response.ok) {
      console.log('‚úÖ Discord —Ä—É—É –º—ç–¥—ç—ç –∏–ª–≥—ç—ç–≥–¥–ª—ç—ç!');
      return true;
    } else {
      console.error('‚ùå Discord –∞–ª–¥–∞–∞:', response.status);
      return false;
    }

  } catch (err) {
    console.error('‚ùå Discord –∏–ª–≥—ç—ç—Ö –∞–ª–¥–∞–∞:', err);
    return false;
  }
}

/** CSV —Ñ–∞–π–ª—ã–≥ Discord-–¥ –∏–ª–≥—ç—ç—Ö */
async function sendCSVToDiscord(csvData, filename, participantInfo) {
  try {
    // CSV —Ñ–∞–π–ª—ã–≥ Blob —Ö—ç–ª–±—ç—Ä—ç—ç—Ä –±—ç–ª—Ç–≥—ç—Ö
    const blob = new Blob([csvData], { type: 'text/csv; charset=utf-8' });
    
    // FormData –±—ç–ª—Ç–≥—ç—Ö
    const formData = new FormData();
    
    // Message –±—ç–ª—Ç–≥—ç—Ö
    const messagePayload = {
      content: `üìÅ **CSV –§–ê–ô–õ**\n**–§–∞–π–ª:** ${filename}\n**–û—Ä–æ–ª—Ü–æ–≥—á:** ${participantInfo.participant}\n**–•—É–≥–∞—Ü–∞–∞:** ${new Date().toLocaleString('mn-MN')}`
    };
    
    formData.append('payload_json', JSON.stringify(messagePayload));
    formData.append('file', blob, filename);

    // Discord —Ä—É—É —Ñ–∞–π–ª –∏–ª–≥—ç—ç—Ö
    const response = await fetch(DISCORD_WEBHOOK_URL, {
      method: 'POST',
      body: formData
    });

    if (response.ok) {
      console.log('‚úÖ CSV —Ñ–∞–π–ª Discord-–¥ –∏–ª–≥—ç—ç–≥–¥–ª—ç—ç!');
      return true;
    } else {
      console.error('‚ùå CSV —Ñ–∞–π–ª –∏–ª–≥—ç—ç—Ö –∞–ª–¥–∞–∞:', response.status);
      return false;
    }

  } catch (err) {
    console.error('‚ùå CSV —Ñ–∞–π–ª –∏–ª–≥—ç—ç—Ö –∞–ª–¥–∞–∞:', err);
    return false;
  }
}

const UTF8_BOM = "\uFEFF";

function toCSV(rows){
  const cols = [
    'idx','part_index','phase_name','part_trial_idx',
    'word','expected_key','pressed_key','correct','rt_ms'
  ];
  const header = cols.join(',');

  const body = rows.map(r =>
    cols.map(c => `"${String(r[c] ?? '').replace(/"/g,'""')}"`).join(',')
  ).join('\n');

  const metaLine =
    `participant_id=${participant.id},age=${participant.age},gender=${participant.gender},started_at=${testStartedAt},finished_at=${testFinishedAt}`;

  // Add survey answers to meta
  const survey1Meta = Object.entries(survey1Answers).map(([q, a]) => `survey1_${q}=${a}`).join(',');
  const survey2Meta = Object.entries(survey2Answers).map(([q, a]) => `survey2_${q}=${a}`).join(',');
  
  const fullMeta = metaLine + (survey1Meta ? ',' + survey1Meta : '') + (survey2Meta ? ',' + survey2Meta : '');

  // 8, 9-—Ä —Ö—ç—Å–≥–∏–π–Ω –º”©—Ä“Ø“Ø–¥–∏–π–≥ —Ç—É—Å–∞–¥ –Ω—å –Ω—ç–º—ç—Ö
  let surveyRows = '';
  
  // 8-—Ä —Ö—ç—Å—ç–≥: ”®”©—Ä–∏–π–Ω “Æ–Ω—ç–ª—ç–º–∂–∏–π–Ω –ê—Å—É—É–ª–≥–∞
  Object.entries(survey1Answers).forEach(([question, answer], index) => {
    surveyRows += `\n"${trialIndex + index + 1}","8","”®”©—Ä–∏–π–Ω “Æ–Ω—ç–ª—ç–º–∂–∏–π–Ω –ê—Å—É—É–ª–≥–∞","${index + 1}","${SURVEY1_QUESTIONS[index].q}","${answer}","${answer}","1","0"`;
  });
  
  // 9-—Ä —Ö—ç—Å—ç–≥: –°—ç—Ç–≥—ç–ª –•”©–¥–ª”©–ª, –ú—ç–¥—Ä—ç–º–∂–∏–π–Ω –ê—Å—É—É–ª–≥–∞  
  Object.entries(survey2Answers).forEach(([question, answer], index) => {
    surveyRows += `\n"${trialIndex + SURVEY1_QUESTIONS.length + index + 1}","9","–°—ç—Ç–≥—ç–ª –•”©–¥–ª”©–ª, –ú—ç–¥—Ä—ç–º–∂–∏–π–Ω –ê—Å—É—É–ª–≥–∞","${index + 1}","${SURVEY2_QUESTIONS[index].q}","${answer}","${answer}","1","0"`;
  });

  return UTF8_BOM + fullMeta + '\n' + header + '\n' + body + surveyRows;
}

function finalizeResults(){
  const csv = toCSV(records);
  const ts = new Date().toISOString().slice(0,19).replace(/[:T]/g,'-');
  const safeId = (participant.id||'anon').replace(/[^\w]/g,'_');
  const filename = `iat_results_${safeId}_${ts}.csv`;

  const totalTime = records.reduce((sum, r) => sum + (Number(r.rt_ms)||0), 0);

  const payload = {
    meta: {
      generated_at: new Date().toISOString(),
      participant: participant.id,
      age: participant.age,
      gender: participant.gender,
      total_records: records.length + SURVEY1_QUESTIONS.length + SURVEY2_QUESTIONS.length,
      total_time_ms: totalTime,
      survey1: survey1Answers,
      survey2: survey2Answers
    },
    participant_data: {
      participant: participant.id,
      age: participant.age,
      gender: participant.gender,
      started_at: testStartedAt,
      finished_at: testFinishedAt
    },
    test_records: records,
    csv_data: csv
  };

  // Discord —Ä—É—É –∏–ª–≥—ç—ç—Ö
  sendToDiscord(payload);
  
  // –ë–∞–≥–∞ –∑—ç—Ä—ç–≥ —Ö“Ø–ª—ç—ç–≥—ç—ç–¥ CSV —Ñ–∞–π–ª –∏–ª–≥—ç—ç—Ö (Discord-–¥ –¥–∞—Ä–∞–∞–ª–∞–ª—Ç–∞–π –∏—Ä—ç—Ö—ç–¥)
  setTimeout(() => {
    sendCSVToDiscord(csv, filename, participant);
  }, 1000);

  renderCompletionUI(csv, filename);
}

function avg(a){ if(!a.length) return NaN; return a.reduce((x,y)=>x+y,0)/a.length; }
function escapeHtml(str){ return String(str).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

function renderCompletionUI(csv, filename){
  const previewText = [
    `Participant: ${participant.id} | Age: ${participant.age} | Gender: ${participant.gender}`,
    `Started: ${testStartedAt} | Finished: ${testFinishedAt}`,
    `Trials: ${records.length} | Correct: ${records.filter(r=>r.correct===1).length} | Incorrect: ${records.filter(r=>r.correct===0).length}`,
    ``,
    csv.split('\n').slice(0,6).join('\n') + '\n...'
  ].join('\n');

  completionMount.innerHTML = `
    <div class="results-box">
      <div class="results-title">–¢–µ—Å—Ç –¥—É—É—Å–ª–∞–∞ ‚Äî –¢–∞–Ω–¥ –±–∞—è—Ä–ª–∞–ª–∞–∞</div>
      <div class="results-role"><strong>–û—Ä–æ–ª—Ü–æ–≥—á:</strong> –•“Ø—Å–≤—ç–ª ”©”©—Ä”©”© —Ñ–∞–π–ª–∞–∞ —Ç–∞—Ç–∞–∂ –∞–≤—á –±–æ–ª–Ω–æ.</div>
      <div class="results-actions">
        <button class="btn btn-success" id="btn-download">–§–∞–π–ª—ã–≥ —Ç–∞—Ç–∞–∂ –∞–≤–∞—Ö (CSV)</button>
        <button class="btn btn-warning" id="btn-toggle">–•–∞—Ä–∏—É–ª—Ç—ã–≥ —Ö–∞—Ä–∞—Ö</button>
      </div>
      <div class="small-note">–¢–∞–π–ª–±–∞—Ä: –ú—ç–¥—ç—ç–ª—ç–ª Discord —Ä—É—É –∞–≤—Ç–æ–º–∞—Ç–∞–∞—Ä –∏–ª–≥—ç—ç–≥–¥—Å—ç–Ω.</div>
      <pre class="results-preview" id="results-preview" style="display:none;">${escapeHtml(previewText)}</pre>
    </div>
  `;

  document.getElementById('btn-download').onclick = function(){
    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8' });
    const a=document.createElement('a');
    a.href=URL.createObjectURL(blob);
    a.download=filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(a.href);
  };

  document.getElementById('btn-toggle').onclick = function(){
    const pr = document.getElementById('results-preview');
    if (pr.style.display === 'none'){ pr.style.display = 'block'; this.textContent='–•–∞—Ä–∏—É–ª—Ç—ã–≥ –Ω—É—É—Ö'; }
    else { pr.style.display = 'none'; this.textContent='–•–∞—Ä–∏—É–ª—Ç—ã–≥ —Ö–∞—Ä–∞—Ö'; }
  };
}
</script>
</body>
</html>
